<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classic Sports Barbershop - Book Now!</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>‚úÇÔ∏è {{ business.name }}</h1>
            <p class="tagline">Classic Cuts, Modern Vibes</p>
        </header>
        
        <div class="quick-info">
            <div class="info-item">
                <span class="icon">üìç</span>
                <span>{{ business.location }}</span>
            </div>
            <div class="info-item">
                <span class="icon">üìû</span>
                <span>{{ business.phone }}</span>
            </div>
            <div class="info-item">
                <span class="icon">üïê</span>
                <span>{{ business.hours }}</span>
            </div>
        </div>
        
        <div class="chat-container">
            <div id="chat-messages" class="chat-messages">
                <div class="message bot">
                    <div class="message-content">
                        <p>üëã Hey! Welcome to {{ business.name }}!</p>
                        <p>I'm here to help you:</p>
                        <ul>
                            <li>üìÖ Book an appointment</li>
                            <li>‚úÇÔ∏è Ask about our services</li>
                            <li>üïê Check our hours</li>
                        </ul>
                        <p>What can I help you with today?</p>
                    </div>
                </div>
            </div>
            
            <div class="chat-input">
                <input type="text" id="user-input" placeholder="Type your message..." autocomplete="off">
                <button id="send-btn">Send</button>
            </div>
        </div>
        
        <div class="services-preview">
            <h3>Our Services</h3>
            <div class="service-list">
                {% for service, price in business.services.items() %}
                <div class="service-item">
                    <span class="service-name">{{ service.title() }}</span>
                    <span class="service-price">{{ price }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <script>
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        
        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;
            
            // Add user message
            addMessage(message, 'user');
            userInput.value = '';
            
            // Show loading
            addLoadingIndicator();
            
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });
                
                const data = await response.json();
                
                // Remove loading
                removeLoadingIndicator();
                
                // Add bot response
                addMessage(data.response, 'bot');
            } catch (error) {
                removeLoadingIndicator();
                addMessage('Sorry, something went wrong. Please try again.', 'bot');
            }
        }
        
        function addMessage(content, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = `<div class="message-content">${content}</div>`;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function addLoadingIndicator() {
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message bot loading';
            loadingDiv.id = 'loading-indicator';
            loadingDiv.innerHTML = '<div class="message-content"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>';
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function removeLoadingIndicator() {
            const loading = document.getElementById('loading-indicator');
            if (loading) loading.remove();
        }
        
        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
        
        userInput.focus();
    </script>
</body>
</html>
